{"version":3,"sources":["useContextSelector.js"],"sourcesContent":["import { useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\n/**\n * @internal\n * This hook returns context selected value by selector.\n * It will only accept context created by `createContext`.\n * It will trigger re-render if only the selected value is referentially changed.\n */ export const useContextSelector = (context, selector)=>{\n    const contextValue = React.useContext(context);\n    const { value: { current: value }, version: { current: version }, listeners } = contextValue;\n    const selected = selector(value);\n    const [state, dispatch] = React.useReducer((prevState, payload)=>{\n        if (!payload) {\n            // early bail out when is dispatched during render\n            return [\n                value,\n                selected\n            ];\n        }\n        if (payload[0] <= version) {\n            if (objectIs(prevState[1], selected)) {\n                return prevState; // bail out\n            }\n            return [\n                value,\n                selected\n            ];\n        }\n        try {\n            if (objectIs(prevState[0], payload[1])) {\n                return prevState; // do not update\n            }\n            const nextSelected = selector(payload[1]);\n            if (objectIs(prevState[1], nextSelected)) {\n                return prevState; // do not update\n            }\n            return [\n                payload[1],\n                nextSelected\n            ];\n        } catch (e) {\n        // ignored (stale props or some other reason)\n        }\n        // explicitly spread to enforce typing\n        return [\n            prevState[0],\n            prevState[1]\n        ]; // schedule update\n    }, [\n        value,\n        selected\n    ]);\n    if (!objectIs(state[1], selected)) {\n        // schedule re-render\n        // this is safe because it's self contained\n        dispatch(undefined);\n    }\n    useIsomorphicLayoutEffect(()=>{\n        listeners.push(dispatch);\n        return ()=>{\n            const index = listeners.indexOf(dispatch);\n            listeners.splice(index, 1);\n        };\n    }, [\n        listeners\n    ]);\n    return state[1];\n};\n/**\n * inlined Object.is polyfill to avoid requiring consumers ship their own\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\n */ // eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction is(x, y) {\n    return x === y && (x !== 0 || 1 / x === 1 / y) || x !== x && y !== y // eslint-disable-line no-self-compare\n    ;\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst objectIs = // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore fallback to native if it exists (not in IE11)\ntypeof Object.is === 'function' ? Object.is : is;\n"],"names":["useContextSelector","context","selector","contextValue","React","useContext","value","current","version","listeners","selected","state","dispatch","useReducer","prevState","payload","objectIs","nextSelected","e","undefined","useIsomorphicLayoutEffect","push","index","indexOf","splice","is","x","y","Object"],"mappings":";;;;+BAOiBA;;;eAAAA;;;;gCAPyB;iEACnB;AAMZ,MAAMA,qBAAqB,CAACC,SAASC;IAC5C,MAAMC,eAAeC,OAAMC,UAAU,CAACJ;IACtC,MAAM,EAAEK,OAAO,EAAEC,SAASD,KAAK,EAAE,EAAEE,SAAS,EAAED,SAASC,OAAO,EAAE,EAAEC,SAAS,EAAE,GAAGN;IAChF,MAAMO,WAAWR,SAASI;IAC1B,MAAM,CAACK,OAAOC,SAAS,GAAGR,OAAMS,UAAU,CAAC,CAACC,WAAWC;QACnD,IAAI,CAACA,SAAS;YACV,kDAAkD;YAClD,OAAO;gBACHT;gBACAI;aACH;QACL;QACA,IAAIK,OAAO,CAAC,EAAE,IAAIP,SAAS;YACvB,IAAIQ,SAASF,SAAS,CAAC,EAAE,EAAEJ,WAAW;gBAClC,OAAOI,WAAW,WAAW;YACjC;YACA,OAAO;gBACHR;gBACAI;aACH;QACL;QACA,IAAI;YACA,IAAIM,SAASF,SAAS,CAAC,EAAE,EAAEC,OAAO,CAAC,EAAE,GAAG;gBACpC,OAAOD,WAAW,gBAAgB;YACtC;YACA,MAAMG,eAAef,SAASa,OAAO,CAAC,EAAE;YACxC,IAAIC,SAASF,SAAS,CAAC,EAAE,EAAEG,eAAe;gBACtC,OAAOH,WAAW,gBAAgB;YACtC;YACA,OAAO;gBACHC,OAAO,CAAC,EAAE;gBACVE;aACH;QACL,EAAE,OAAOC,GAAG;QACZ,6CAA6C;QAC7C;QACA,sCAAsC;QACtC,OAAO;YACHJ,SAAS,CAAC,EAAE;YACZA,SAAS,CAAC,EAAE;SACf,EAAE,kBAAkB;IACzB,GAAG;QACCR;QACAI;KACH;IACD,IAAI,CAACM,SAASL,KAAK,CAAC,EAAE,EAAED,WAAW;QAC/B,qBAAqB;QACrB,2CAA2C;QAC3CE,SAASO;IACb;IACAC,IAAAA,yCAAyB,EAAC;QACtBX,UAAUY,IAAI,CAACT;QACf,OAAO;YACH,MAAMU,QAAQb,UAAUc,OAAO,CAACX;YAChCH,UAAUe,MAAM,CAACF,OAAO;QAC5B;IACJ,GAAG;QACCb;KACH;IACD,OAAOE,KAAK,CAAC,EAAE;AACnB;AACA;;;CAGC,GAAG,8DAA8D;AAClE,SAASc,GAAGC,CAAC,EAAEC,CAAC;IACZ,OAAOD,MAAMC,KAAMD,CAAAA,MAAM,KAAK,IAAIA,MAAM,IAAIC,CAAAA,KAAMD,MAAMA,KAAKC,MAAMA,EAAE,sCAAsC;;AAE/G;AACA,8DAA8D;AAC9D,MAAMX,WACN,2DAA2D;AAC3D,OAAOY,OAAOH,EAAE,KAAK,aAAaG,OAAOH,EAAE,GAAGA"}