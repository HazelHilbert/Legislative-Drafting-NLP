{"version":3,"sources":["createContext.js"],"sourcesContent":["import { useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { unstable_NormalPriority as NormalPriority, unstable_runWithPriority as runWithPriority } from 'scheduler';\nconst createProvider = (Original)=>{\n    const Provider = (props)=>{\n        // Holds an actual \"props.value\"\n        const valueRef = React.useRef(props.value);\n        // Used to sync context updates and avoid stale values, can be considered as render/effect counter of Provider.\n        const versionRef = React.useRef(0);\n        // A stable object, is used to avoid context updates via mutation of its values.\n        const contextValue = React.useRef();\n        if (!contextValue.current) {\n            contextValue.current = {\n                value: valueRef,\n                version: versionRef,\n                listeners: []\n            };\n        }\n        useIsomorphicLayoutEffect(()=>{\n            valueRef.current = props.value;\n            versionRef.current += 1;\n            runWithPriority(NormalPriority, ()=>{\n                contextValue.current.listeners.forEach((listener)=>{\n                    listener([\n                        versionRef.current,\n                        props.value\n                    ]);\n                });\n            });\n        }, [\n            props.value\n        ]);\n        return React.createElement(Original, {\n            value: contextValue.current\n        }, props.children);\n    };\n    /* istanbul ignore else */ if (process.env.NODE_ENV !== 'production') {\n        Provider.displayName = 'ContextSelector.Provider';\n    }\n    return Provider;\n};\n/**\n * @internal\n */ export const createContext = (defaultValue)=>{\n    // eslint-disable-next-line @fluentui/no-context-default-value\n    const context = React.createContext({\n        value: {\n            current: defaultValue\n        },\n        version: {\n            current: -1\n        },\n        listeners: []\n    });\n    context.Provider = createProvider(context.Provider);\n    // We don't support Consumer API\n    delete context.Consumer;\n    return context;\n};\n"],"names":["createContext","createProvider","Original","Provider","props","valueRef","React","useRef","value","versionRef","contextValue","current","version","listeners","useIsomorphicLayoutEffect","runWithPriority","NormalPriority","forEach","listener","createElement","children","process","env","NODE_ENV","displayName","defaultValue","context","Consumer"],"mappings":";;;;+BA2CiBA;;;eAAAA;;;;gCA3CyB;iEACnB;2BACgF;AACvG,MAAMC,iBAAiB,CAACC;IACpB,MAAMC,WAAW,CAACC;QACd,gCAAgC;QAChC,MAAMC,WAAWC,OAAMC,MAAM,CAACH,MAAMI,KAAK;QACzC,+GAA+G;QAC/G,MAAMC,aAAaH,OAAMC,MAAM,CAAC;QAChC,gFAAgF;QAChF,MAAMG,eAAeJ,OAAMC,MAAM;QACjC,IAAI,CAACG,aAAaC,OAAO,EAAE;YACvBD,aAAaC,OAAO,GAAG;gBACnBH,OAAOH;gBACPO,SAASH;gBACTI,WAAW,EAAE;YACjB;QACJ;QACAC,IAAAA,yCAAyB,EAAC;YACtBT,SAASM,OAAO,GAAGP,MAAMI,KAAK;YAC9BC,WAAWE,OAAO,IAAI;YACtBI,IAAAA,mCAAe,EAACC,kCAAc,EAAE;gBAC5BN,aAAaC,OAAO,CAACE,SAAS,CAACI,OAAO,CAAC,CAACC;oBACpCA,SAAS;wBACLT,WAAWE,OAAO;wBAClBP,MAAMI,KAAK;qBACd;gBACL;YACJ;QACJ,GAAG;YACCJ,MAAMI,KAAK;SACd;QACD,qBAAOF,OAAMa,aAAa,CAACjB,UAAU;YACjCM,OAAOE,aAAaC,OAAO;QAC/B,GAAGP,MAAMgB,QAAQ;IACrB;IACA,wBAAwB,GAAG,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;QAClEpB,SAASqB,WAAW,GAAG;IAC3B;IACA,OAAOrB;AACX;AAGW,MAAMH,gBAAgB,CAACyB;IAC9B,8DAA8D;IAC9D,MAAMC,wBAAUpB,OAAMN,aAAa,CAAC;QAChCQ,OAAO;YACHG,SAASc;QACb;QACAb,SAAS;YACLD,SAAS,CAAC;QACd;QACAE,WAAW,EAAE;IACjB;IACAa,QAAQvB,QAAQ,GAAGF,eAAeyB,QAAQvB,QAAQ;IAClD,gCAAgC;IAChC,OAAOuB,QAAQC,QAAQ;IACvB,OAAOD;AACX"}