{"version":3,"sources":["useAriaLiveAnnouncer.js"],"sourcesContent":["import { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { createPriorityQueue, useTimeout } from '@fluentui/react-utilities';\nimport * as React from 'react';\n/** The duration the message needs to be in present in DOM for screen readers to register a change and announce */ const MESSAGE_DURATION = 500;\nconst VISUALLY_HIDDEN_STYLES = {\n    clip: 'rect(0px, 0px, 0px, 0px)',\n    height: '1px',\n    margin: '-1px',\n    width: '1px',\n    position: 'absolute',\n    overflow: 'hidden',\n    textWrap: 'nowrap'\n};\nexport const useAriaLiveAnnouncer_unstable = (props)=>{\n    const { targetDocument } = useFluent();\n    const timeoutRef = React.useRef(undefined);\n    const [setAnnounceTimeout, clearAnnounceTimeout] = useTimeout();\n    const elementRef = React.useRef(null);\n    const order = React.useRef(0);\n    // investigate alert implementation later\n    // const [alertList, setAlertList] = React.useState<string[]>([]);\n    const batchMessages = React.useRef([]);\n    const [messageQueue] = React.useState(()=>createPriorityQueue((a, b)=>{\n            if (a.priority !== b.priority) {\n                return b.priority - a.priority;\n            }\n            return a.createdAt - b.createdAt;\n        }));\n    const queueMessage = React.useCallback(()=>{\n        if (timeoutRef.current || !elementRef.current) {\n            return;\n        }\n        const runCycle = ()=>{\n            if (!elementRef.current) {\n                return;\n            }\n            if (targetDocument && messageQueue.peek()) {\n                // need a wrapping element for Narrator/Edge, which currently does not pick up text-only live region changes\n                // consistently\n                // if this is fixed, we can set textContent to the string directly\n                const wrappingEl = targetDocument.createElement('span');\n                wrappingEl.innerText = messageQueue.all().filter((msg)=>msg.message.trim().length > 0).reduce((prevText, currMsg)=>prevText + currMsg.message + '. ', '');\n                elementRef.current.innerText = '';\n                elementRef.current.appendChild(wrappingEl);\n                messageQueue.clear();\n                batchMessages.current = [];\n                // begin new cycle to clear (or update) messages\n                timeoutRef.current = setAnnounceTimeout(()=>{\n                    runCycle();\n                }, MESSAGE_DURATION);\n            } else {\n                elementRef.current.textContent = '';\n                clearAnnounceTimeout();\n                timeoutRef.current = undefined;\n            }\n        };\n        runCycle();\n    }, [\n        clearAnnounceTimeout,\n        messageQueue,\n        setAnnounceTimeout,\n        targetDocument\n    ]);\n    const announce = React.useMemo(()=>(message, options = {})=>{\n            const { alert = false, priority = 0, batchId } = options;\n            // check if message is an alert\n            if (alert) {\n            // TODO: alert implementation\n            // setAlertList([...alertList, message]);\n            }\n            const liveMessage = {\n                message,\n                createdAt: order.current++,\n                priority,\n                batchId\n            };\n            // check if batchId exists\n            if (batchId) {\n                // update associated msg if it does\n                const batchMessage = batchMessages.current.find((msg)=>msg.batchId === batchId);\n                if (batchMessage) {\n                    // replace existing message in queue\n                    messageQueue.remove(batchMessage.message);\n                    // update list of existing batchIds w/ most recent message\n                    batchMessage.message = liveMessage;\n                } else {\n                    // update list of existing batchIds, add new if doesn't already exist\n                    batchMessages.current = [\n                        ...batchMessages.current,\n                        {\n                            batchId,\n                            message: liveMessage\n                        }\n                    ];\n                }\n            }\n            // add new message\n            messageQueue.enqueue(liveMessage);\n            queueMessage();\n        }, [\n        messageQueue,\n        queueMessage\n    ]);\n    React.useEffect(()=>{\n        if (!targetDocument) {\n            return;\n        }\n        const element = targetDocument.createElement('div');\n        element.setAttribute('aria-live', 'assertive');\n        Object.assign(element.style, VISUALLY_HIDDEN_STYLES);\n        targetDocument.body.append(element);\n        elementRef.current = element;\n        return ()=>{\n            element.remove();\n            elementRef.current = null;\n        };\n    }, [\n        targetDocument\n    ]);\n    return {\n        announce,\n        children: props.children\n    };\n};\n"],"names":["useAriaLiveAnnouncer_unstable","MESSAGE_DURATION","VISUALLY_HIDDEN_STYLES","clip","height","margin","width","position","overflow","textWrap","props","targetDocument","useFluent","timeoutRef","React","useRef","undefined","setAnnounceTimeout","clearAnnounceTimeout","useTimeout","elementRef","order","batchMessages","messageQueue","useState","createPriorityQueue","a","b","priority","createdAt","queueMessage","useCallback","current","runCycle","peek","wrappingEl","createElement","innerText","all","filter","msg","message","trim","length","reduce","prevText","currMsg","appendChild","clear","textContent","announce","useMemo","options","alert","batchId","liveMessage","batchMessage","find","remove","enqueue","useEffect","element","setAttribute","Object","assign","style","body","append","children"],"mappings":"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"}