{"version":3,"sources":["useVirtualizerScrollViewDynamic.js"],"sourcesContent":["import * as React from 'react';\nimport { slot, useMergedRefs } from '@fluentui/react-utilities';\nimport { useVirtualizer_unstable } from '../Virtualizer/useVirtualizer';\nimport { useDynamicVirtualizerMeasure } from '../../Hooks';\nimport { useVirtualizerContextState_unstable, scrollToItemDynamic } from '../../Utilities';\nimport { useImperativeHandle } from 'react';\nimport { useMeasureList } from '../../hooks/useMeasureList';\nexport function useVirtualizerScrollViewDynamic_unstable(props) {\n    const contextState = useVirtualizerContextState_unstable(props.virtualizerContext);\n    const { imperativeRef, axis = 'vertical', reversed, imperativeVirtualizerRef } = props;\n    let sizeTrackingArray = React.useRef(new Array(props.numItems).fill(props.itemSize));\n    const getChildSizeAuto = React.useCallback((index)=>{\n        if (sizeTrackingArray.current.length <= index || sizeTrackingArray.current[index] <= 0) {\n            // Default size for initial state or untracked\n            return props.itemSize;\n        }\n        /* Required to be defined prior to our measure function\n       * we use a sizing array ref that we will update post-render\n       */ return sizeTrackingArray.current[index];\n    }, [\n        sizeTrackingArray,\n        props.itemSize\n    ]);\n    var _props_axis, _props_getItemSize, _contextState_contextIndex;\n    const { virtualizerLength, bufferItems, bufferSize, scrollRef } = useDynamicVirtualizerMeasure({\n        defaultItemSize: props.itemSize,\n        direction: (_props_axis = props.axis) !== null && _props_axis !== void 0 ? _props_axis : 'vertical',\n        getItemSize: (_props_getItemSize = props.getItemSize) !== null && _props_getItemSize !== void 0 ? _props_getItemSize : getChildSizeAuto,\n        currentIndex: (_contextState_contextIndex = contextState === null || contextState === void 0 ? void 0 : contextState.contextIndex) !== null && _contextState_contextIndex !== void 0 ? _contextState_contextIndex : 0,\n        numItems: props.numItems\n    });\n    // Store the virtualizer length as a ref for imperative ref access\n    const virtualizerLengthRef = React.useRef(virtualizerLength);\n    if (virtualizerLengthRef.current !== virtualizerLength) {\n        virtualizerLengthRef.current = virtualizerLength;\n    }\n    const scrollViewRef = useMergedRefs(props.scrollViewRef, scrollRef);\n    const scrollCallbackRef = React.useRef(null);\n    const _imperativeVirtualizerRef = useMergedRefs(React.useRef(null), imperativeVirtualizerRef);\n    useImperativeHandle(imperativeRef, ()=>{\n        var _imperativeVirtualizerRef_current;\n        return {\n            scrollTo (index, behavior = 'auto', callback) {\n                scrollCallbackRef.current = callback !== null && callback !== void 0 ? callback : null;\n                if (_imperativeVirtualizerRef.current) {\n                    var _imperativeVirtualizerRef_current;\n                    const progressiveSizes = _imperativeVirtualizerRef.current.progressiveSizes.current;\n                    const totalSize = progressiveSizes && (progressiveSizes === null || progressiveSizes === void 0 ? void 0 : progressiveSizes.length) > 0 ? progressiveSizes[Math.max(progressiveSizes.length - 1, 0)] : 0;\n                    _imperativeVirtualizerRef.current.setFlaggedIndex(index);\n                    scrollToItemDynamic({\n                        index,\n                        itemSizes: (_imperativeVirtualizerRef_current = _imperativeVirtualizerRef.current) === null || _imperativeVirtualizerRef_current === void 0 ? void 0 : _imperativeVirtualizerRef_current.nodeSizes,\n                        totalSize,\n                        scrollViewRef,\n                        axis,\n                        reversed,\n                        behavior\n                    });\n                }\n            },\n            currentIndex: (_imperativeVirtualizerRef_current = _imperativeVirtualizerRef.current) === null || _imperativeVirtualizerRef_current === void 0 ? void 0 : _imperativeVirtualizerRef_current.currentIndex,\n            virtualizerLength: virtualizerLengthRef\n        };\n    }, [\n        axis,\n        scrollViewRef,\n        reversed,\n        _imperativeVirtualizerRef\n    ]);\n    const handleRenderedIndex = (index)=>{\n        if (scrollCallbackRef.current) {\n            scrollCallbackRef.current(index);\n        }\n    };\n    var _props_getItemSize1;\n    const virtualizerState = useVirtualizer_unstable({\n        ...props,\n        getItemSize: (_props_getItemSize1 = props.getItemSize) !== null && _props_getItemSize1 !== void 0 ? _props_getItemSize1 : getChildSizeAuto,\n        virtualizerLength,\n        bufferItems,\n        bufferSize,\n        scrollViewRef,\n        virtualizerContext: contextState,\n        imperativeVirtualizerRef: _imperativeVirtualizerRef,\n        onRenderedFlaggedIndex: handleRenderedIndex\n    });\n    const measureObject = useMeasureList(virtualizerState.virtualizerStartIndex, virtualizerLength, props.numItems, props.itemSize);\n    if (axis === 'horizontal') {\n        sizeTrackingArray = measureObject.widthArray;\n    } else {\n        sizeTrackingArray = measureObject.heightArray;\n    }\n    if (!props.getItemSize) {\n        // Auto-measuring is required\n        React.Children.map(virtualizerState.virtualizedChildren, (child, index)=>{\n            if (/*#__PURE__*/ React.isValidElement(child)) {\n                virtualizerState.virtualizedChildren[index] = /*#__PURE__*/ React.createElement(child.type, {\n                    ...child.props,\n                    key: child.key,\n                    ref: (element)=>{\n                        // If a ref exists in props, call it\n                        if (typeof child.props.ref === 'function') {\n                            child.props.ref(element);\n                        } else if (child.props.ref) {\n                            child.props.ref.current = element;\n                        }\n                        if (child.hasOwnProperty('ref')) {\n                            // We must access this from the child directly, not props (forward ref).\n                            // eslint-disable-next-line  @typescript-eslint/no-explicit-any\n                            const localRef = child === null || child === void 0 ? void 0 : child.ref;\n                            if (typeof localRef === 'function') {\n                                localRef(element);\n                            } else if (localRef) {\n                                localRef.current = element;\n                            }\n                        }\n                        // Call the auto-measure ref attachment.\n                        measureObject.createIndexedRef(index)(element);\n                    }\n                });\n            }\n        });\n    }\n    return {\n        ...virtualizerState,\n        components: {\n            ...virtualizerState.components,\n            container: 'div'\n        },\n        container: slot.always(props.container, {\n            defaultProps: {\n                ref: scrollViewRef\n            },\n            elementType: 'div'\n        })\n    };\n}\n"],"names":["useVirtualizerScrollViewDynamic_unstable","props","contextState","useVirtualizerContextState_unstable","virtualizerContext","imperativeRef","axis","reversed","imperativeVirtualizerRef","sizeTrackingArray","React","useRef","Array","numItems","fill","itemSize","getChildSizeAuto","useCallback","index","current","length","_props_axis","_props_getItemSize","_contextState_contextIndex","virtualizerLength","bufferItems","bufferSize","scrollRef","useDynamicVirtualizerMeasure","defaultItemSize","direction","getItemSize","currentIndex","contextIndex","virtualizerLengthRef","scrollViewRef","useMergedRefs","scrollCallbackRef","_imperativeVirtualizerRef","useImperativeHandle","_imperativeVirtualizerRef_current","scrollTo","behavior","callback","progressiveSizes","totalSize","Math","max","setFlaggedIndex","scrollToItemDynamic","itemSizes","nodeSizes","handleRenderedIndex","_props_getItemSize1","virtualizerState","useVirtualizer_unstable","onRenderedFlaggedIndex","measureObject","useMeasureList","virtualizerStartIndex","widthArray","heightArray","Children","map","virtualizedChildren","child","isValidElement","createElement","type","key","ref","element","hasOwnProperty","localRef","createIndexedRef","components","container","slot","always","defaultProps","elementType"],"mappings":"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"}