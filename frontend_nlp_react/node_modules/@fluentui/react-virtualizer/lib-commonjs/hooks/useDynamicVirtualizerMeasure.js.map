{"version":3,"sources":["useDynamicVirtualizerMeasure.js"],"sourcesContent":["import { useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { useResizeObserverRef_unstable } from './useResizeObserverRef';\nimport { useRef } from 'react';\n/**\n * React hook that measures virtualized space dynamically to ensure optimized virtualization length.\n */ export const useDynamicVirtualizerMeasure = (virtualizerProps)=>{\n    const { defaultItemSize, direction = 'vertical', numItems, getItemSize, currentIndex } = virtualizerProps;\n    const indexRef = useRef(currentIndex);\n    indexRef.current = currentIndex;\n    const [state, setState] = React.useState({\n        virtualizerLength: 0,\n        virtualizerBufferItems: 0,\n        virtualizerBufferSize: 0\n    });\n    const { virtualizerLength, virtualizerBufferItems, virtualizerBufferSize } = state;\n    const container = React.useRef(null);\n    const handleScrollResize = React.useCallback((scrollRef)=>{\n        if (!(scrollRef === null || scrollRef === void 0 ? void 0 : scrollRef.current)) {\n            // Error? ignore?\n            return;\n        }\n        if (scrollRef.current !== container.current) {\n            container.current = scrollRef.current;\n        }\n        const containerSize = direction === 'vertical' ? scrollRef.current.getBoundingClientRect().height : scrollRef.current.getBoundingClientRect().width;\n        let indexSizer = 0;\n        let length = 0;\n        while(indexSizer <= containerSize && length < numItems){\n            const iItemSize = getItemSize(indexRef.current + length);\n            // Increment\n            indexSizer += iItemSize;\n            length++;\n        }\n        /*\n       * Number of items to append at each end, i.e. 'preload' each side before entering view.\n       */ const bufferItems = Math.max(Math.floor(length / 4), 4);\n        /*\n       * This is how far we deviate into the bufferItems to detect a redraw.\n       */ const bufferSize = Math.max(Math.floor(length / 8 * defaultItemSize), 1);\n        const totalLength = length + bufferItems * 2 + 1;\n        setState({\n            virtualizerLength: totalLength,\n            virtualizerBufferSize: bufferSize,\n            virtualizerBufferItems: bufferItems\n        });\n    }, [\n        defaultItemSize,\n        direction,\n        getItemSize,\n        numItems\n    ]);\n    const resizeCallback = React.useCallback((_entries, _observer, scrollRef)=>{\n        if (scrollRef) {\n            handleScrollResize(scrollRef);\n        }\n    }, [\n        handleScrollResize\n    ]);\n    const scrollRef = useResizeObserverRef_unstable(resizeCallback);\n    useIsomorphicLayoutEffect(()=>{\n        var _container_current, _container_current1;\n        if (!container.current) {\n            return;\n        }\n        const containerSize = direction === 'vertical' ? ((_container_current = container.current) === null || _container_current === void 0 ? void 0 : _container_current.getBoundingClientRect().height) * 1.5 : ((_container_current1 = container.current) === null || _container_current1 === void 0 ? void 0 : _container_current1.getBoundingClientRect().width) * 1.5;\n        let couldBeSmaller = false;\n        let recheckTotal = 0;\n        for(let i = currentIndex; i < currentIndex + virtualizerLength; i++){\n            const newItemSize = getItemSize(i);\n            recheckTotal += newItemSize;\n            const newLength = i - currentIndex;\n            const bufferItems = Math.max(Math.floor(newLength / 4), 2);\n            const totalNewLength = newLength + bufferItems * 2 + 4;\n            const compareLengths = totalNewLength < virtualizerLength;\n            if (recheckTotal > containerSize && compareLengths) {\n                couldBeSmaller = true;\n                break;\n            }\n        }\n        // Check if the render has caused us to need a re-calc of virtualizer length\n        if (recheckTotal < containerSize || couldBeSmaller) {\n            handleScrollResize(container);\n        }\n    }, [\n        getItemSize,\n        currentIndex,\n        direction,\n        virtualizerLength,\n        resizeCallback,\n        handleScrollResize\n    ]);\n    return {\n        virtualizerLength,\n        bufferItems: virtualizerBufferItems,\n        bufferSize: virtualizerBufferSize,\n        scrollRef\n    };\n};\n"],"names":["useDynamicVirtualizerMeasure","virtualizerProps","defaultItemSize","direction","numItems","getItemSize","currentIndex","indexRef","useRef","current","state","setState","React","useState","virtualizerLength","virtualizerBufferItems","virtualizerBufferSize","container","handleScrollResize","useCallback","scrollRef","containerSize","getBoundingClientRect","height","width","indexSizer","length","iItemSize","bufferItems","Math","max","floor","bufferSize","totalLength","resizeCallback","_entries","_observer","useResizeObserverRef_unstable","useIsomorphicLayoutEffect","_container_current","_container_current1","couldBeSmaller","recheckTotal","i","newItemSize","newLength","totalNewLength","compareLengths"],"mappings":";;;;+BAMiBA;;;eAAAA;;;;gCANyB;iEACnB;sCACuB;AAInC,MAAMA,+BAA+B,CAACC;IAC7C,MAAM,EAAEC,eAAe,EAAEC,YAAY,UAAU,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,YAAY,EAAE,GAAGL;IACzF,MAAMM,WAAWC,IAAAA,aAAM,EAACF;IACxBC,SAASE,OAAO,GAAGH;IACnB,MAAM,CAACI,OAAOC,SAAS,GAAGC,OAAMC,QAAQ,CAAC;QACrCC,mBAAmB;QACnBC,wBAAwB;QACxBC,uBAAuB;IAC3B;IACA,MAAM,EAAEF,iBAAiB,EAAEC,sBAAsB,EAAEC,qBAAqB,EAAE,GAAGN;IAC7E,MAAMO,YAAYL,OAAMJ,MAAM,CAAC;IAC/B,MAAMU,qBAAqBN,OAAMO,WAAW,CAAC,CAACC;QAC1C,IAAI,CAAEA,CAAAA,cAAc,QAAQA,cAAc,KAAK,IAAI,KAAK,IAAIA,UAAUX,OAAO,AAAD,GAAI;YAC5E,iBAAiB;YACjB;QACJ;QACA,IAAIW,UAAUX,OAAO,KAAKQ,UAAUR,OAAO,EAAE;YACzCQ,UAAUR,OAAO,GAAGW,UAAUX,OAAO;QACzC;QACA,MAAMY,gBAAgBlB,cAAc,aAAaiB,UAAUX,OAAO,CAACa,qBAAqB,GAAGC,MAAM,GAAGH,UAAUX,OAAO,CAACa,qBAAqB,GAAGE,KAAK;QACnJ,IAAIC,aAAa;QACjB,IAAIC,SAAS;QACb,MAAMD,cAAcJ,iBAAiBK,SAAStB,SAAS;YACnD,MAAMuB,YAAYtB,YAAYE,SAASE,OAAO,GAAGiB;YACjD,YAAY;YACZD,cAAcE;YACdD;QACJ;QACA;;OAED,GAAG,MAAME,cAAcC,KAAKC,GAAG,CAACD,KAAKE,KAAK,CAACL,SAAS,IAAI;QACvD;;OAED,GAAG,MAAMM,aAAaH,KAAKC,GAAG,CAACD,KAAKE,KAAK,CAACL,SAAS,IAAIxB,kBAAkB;QACxE,MAAM+B,cAAcP,SAASE,cAAc,IAAI;QAC/CjB,SAAS;YACLG,mBAAmBmB;YACnBjB,uBAAuBgB;YACvBjB,wBAAwBa;QAC5B;IACJ,GAAG;QACC1B;QACAC;QACAE;QACAD;KACH;IACD,MAAM8B,iBAAiBtB,OAAMO,WAAW,CAAC,CAACgB,UAAUC,WAAWhB;QAC3D,IAAIA,WAAW;YACXF,mBAAmBE;QACvB;IACJ,GAAG;QACCF;KACH;IACD,MAAME,YAAYiB,IAAAA,mDAA6B,EAACH;IAChDI,IAAAA,yCAAyB,EAAC;QACtB,IAAIC,oBAAoBC;QACxB,IAAI,CAACvB,UAAUR,OAAO,EAAE;YACpB;QACJ;QACA,MAAMY,gBAAgBlB,cAAc,aAAa,AAAC,CAAA,AAACoC,CAAAA,qBAAqBtB,UAAUR,OAAO,AAAD,MAAO,QAAQ8B,uBAAuB,KAAK,IAAI,KAAK,IAAIA,mBAAmBjB,qBAAqB,GAAGC,MAAM,AAAD,IAAK,MAAM,AAAC,CAAA,AAACiB,CAAAA,sBAAsBvB,UAAUR,OAAO,AAAD,MAAO,QAAQ+B,wBAAwB,KAAK,IAAI,KAAK,IAAIA,oBAAoBlB,qBAAqB,GAAGE,KAAK,AAAD,IAAK;QACjW,IAAIiB,iBAAiB;QACrB,IAAIC,eAAe;QACnB,IAAI,IAAIC,IAAIrC,cAAcqC,IAAIrC,eAAeQ,mBAAmB6B,IAAI;YAChE,MAAMC,cAAcvC,YAAYsC;YAChCD,gBAAgBE;YAChB,MAAMC,YAAYF,IAAIrC;YACtB,MAAMsB,cAAcC,KAAKC,GAAG,CAACD,KAAKE,KAAK,CAACc,YAAY,IAAI;YACxD,MAAMC,iBAAiBD,YAAYjB,cAAc,IAAI;YACrD,MAAMmB,iBAAiBD,iBAAiBhC;YACxC,IAAI4B,eAAerB,iBAAiB0B,gBAAgB;gBAChDN,iBAAiB;gBACjB;YACJ;QACJ;QACA,4EAA4E;QAC5E,IAAIC,eAAerB,iBAAiBoB,gBAAgB;YAChDvB,mBAAmBD;QACvB;IACJ,GAAG;QACCZ;QACAC;QACAH;QACAW;QACAoB;QACAhB;KACH;IACD,OAAO;QACHJ;QACAc,aAAab;QACbiB,YAAYhB;QACZI;IACJ;AACJ"}