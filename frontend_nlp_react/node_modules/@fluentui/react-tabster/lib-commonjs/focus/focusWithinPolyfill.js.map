{"version":3,"sources":["focusWithinPolyfill.js"],"sourcesContent":["import { KEYBORG_FOCUSIN, createKeyborg, disposeKeyborg } from 'keyborg';\nimport { FOCUS_WITHIN_ATTR } from './constants';\n/**\n * A ponyfill that allows `:focus-within` to support visibility based on keyboard/mouse navigation\n * like `:focus-visible` https://github.com/WICG/focus-visible/issues/151\n * @returns ref to the element that uses `:focus-within` styles\n */ export function applyFocusWithinPolyfill(element, win) {\n    const keyborg = createKeyborg(win);\n    // When navigation mode changes to mouse, remove the focus-within selector\n    keyborg.subscribe((isNavigatingWithKeyboard)=>{\n        if (!isNavigatingWithKeyboard) {\n            removeFocusWithinClass(element);\n        }\n    });\n    // Keyborg's focusin event is delegated so it's only registered once on the window\n    // and contains metadata about the focus event\n    const keyborgListener = (e)=>{\n        if (keyborg.isNavigatingWithKeyboard() && isHTMLElement(e.target)) {\n            // Griffel can't create chained global styles so use the parent element for now\n            applyFocusWithinClass(element);\n        }\n    };\n    // Make sure that when focus leaves the scope, the focus within class is removed\n    const blurListener = (e)=>{\n        if (!e.relatedTarget || isHTMLElement(e.relatedTarget) && !element.contains(e.relatedTarget)) {\n            removeFocusWithinClass(element);\n        }\n    };\n    element.addEventListener(KEYBORG_FOCUSIN, keyborgListener);\n    element.addEventListener('focusout', blurListener);\n    // Return disposer\n    return ()=>{\n        element.removeEventListener(KEYBORG_FOCUSIN, keyborgListener);\n        element.removeEventListener('focusout', blurListener);\n        disposeKeyborg(keyborg);\n    };\n}\nfunction applyFocusWithinClass(el) {\n    el.setAttribute(FOCUS_WITHIN_ATTR, '');\n}\nfunction removeFocusWithinClass(el) {\n    el.removeAttribute(FOCUS_WITHIN_ATTR);\n}\nfunction isHTMLElement(target) {\n    if (!target) {\n        return false;\n    }\n    return Boolean(target && typeof target === 'object' && 'classList' in target && 'contains' in target);\n}\n"],"names":["applyFocusWithinPolyfill","element","win","keyborg","createKeyborg","subscribe","isNavigatingWithKeyboard","removeFocusWithinClass","keyborgListener","e","isHTMLElement","target","applyFocusWithinClass","blurListener","relatedTarget","contains","addEventListener","KEYBORG_FOCUSIN","removeEventListener","disposeKeyborg","el","setAttribute","FOCUS_WITHIN_ATTR","removeAttribute","Boolean"],"mappings":";;;;+BAMoBA;;;eAAAA;;;yBAN2C;2BAC7B;AAKvB,SAASA,yBAAyBC,OAAO,EAAEC,GAAG;IACrD,MAAMC,UAAUC,IAAAA,sBAAa,EAACF;IAC9B,0EAA0E;IAC1EC,QAAQE,SAAS,CAAC,CAACC;QACf,IAAI,CAACA,0BAA0B;YAC3BC,uBAAuBN;QAC3B;IACJ;IACA,kFAAkF;IAClF,8CAA8C;IAC9C,MAAMO,kBAAkB,CAACC;QACrB,IAAIN,QAAQG,wBAAwB,MAAMI,cAAcD,EAAEE,MAAM,GAAG;YAC/D,+EAA+E;YAC/EC,sBAAsBX;QAC1B;IACJ;IACA,gFAAgF;IAChF,MAAMY,eAAe,CAACJ;QAClB,IAAI,CAACA,EAAEK,aAAa,IAAIJ,cAAcD,EAAEK,aAAa,KAAK,CAACb,QAAQc,QAAQ,CAACN,EAAEK,aAAa,GAAG;YAC1FP,uBAAuBN;QAC3B;IACJ;IACAA,QAAQe,gBAAgB,CAACC,wBAAe,EAAET;IAC1CP,QAAQe,gBAAgB,CAAC,YAAYH;IACrC,kBAAkB;IAClB,OAAO;QACHZ,QAAQiB,mBAAmB,CAACD,wBAAe,EAAET;QAC7CP,QAAQiB,mBAAmB,CAAC,YAAYL;QACxCM,IAAAA,uBAAc,EAAChB;IACnB;AACJ;AACA,SAASS,sBAAsBQ,EAAE;IAC7BA,GAAGC,YAAY,CAACC,4BAAiB,EAAE;AACvC;AACA,SAASf,uBAAuBa,EAAE;IAC9BA,GAAGG,eAAe,CAACD,4BAAiB;AACxC;AACA,SAASZ,cAAcC,MAAM;IACzB,IAAI,CAACA,QAAQ;QACT,OAAO;IACX;IACA,OAAOa,QAAQb,UAAU,OAAOA,WAAW,YAAY,eAAeA,UAAU,cAAcA;AAClG"}