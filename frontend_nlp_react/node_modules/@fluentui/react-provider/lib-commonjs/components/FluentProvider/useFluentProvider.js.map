{"version":3,"sources":["useFluentProvider.js"],"sourcesContent":["import { useRenderer_unstable } from '@griffel/react';\nimport { useFocusVisible } from '@fluentui/react-tabster';\nimport { ThemeContext_unstable as ThemeContext, useFluent_unstable as useFluent, useOverrides_unstable as useOverrides, CustomStyleHooksContext_unstable as CustomStyleHooksContext } from '@fluentui/react-shared-contexts';\nimport { getIntrinsicElementProps, useMergedRefs, slot } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { useFluentProviderThemeStyleTag } from './useFluentProviderThemeStyleTag';\n// Fixes a bug where returning a new object each time would cause unnecessary rerenders.\nconst EMPTY_OBJECT = {};\n/**\n * Create the state required to render FluentProvider.\n *\n * The returned state can be modified with hooks such as useFluentProviderStyles_unstable,\n * before being passed to renderFluentProvider_unstable.\n *\n * @param props - props from this instance of FluentProvider\n * @param ref - reference to root HTMLElement of FluentProvider\n */ export const useFluentProvider_unstable = (props, ref)=>{\n    const parentContext = useFluent();\n    const parentTheme = useTheme();\n    const parentOverrides = useOverrides();\n    const parentCustomStyleHooks = React.useContext(CustomStyleHooksContext) || EMPTY_OBJECT;\n    /**\n   * TODO: add merge functions to \"dir\" merge,\n   * nesting providers with the same \"dir\" should not add additional attributes to DOM\n   * see https://github.com/microsoft/fluentui/blob/0dc74a19f3aa5a058224c20505016fbdb84db172/packages/fluentui/react-northstar/src/utils/mergeProviderContexts.ts#L89-L93\n   */ const { applyStylesToPortals = true, // eslint-disable-next-line @typescript-eslint/naming-convention\n    customStyleHooks_unstable, dir = parentContext.dir, targetDocument = parentContext.targetDocument, theme, overrides_unstable: overrides = {} } = props;\n    const mergedTheme = shallowMerge(parentTheme, theme);\n    const mergedOverrides = shallowMerge(parentOverrides, overrides);\n    const mergedCustomStyleHooks = shallowMerge(parentCustomStyleHooks, customStyleHooks_unstable);\n    const renderer = useRenderer_unstable();\n    var _renderer_styleElementAttributes;\n    const { styleTagId, rule } = useFluentProviderThemeStyleTag({\n        theme: mergedTheme,\n        targetDocument,\n        rendererAttributes: (_renderer_styleElementAttributes = renderer.styleElementAttributes) !== null && _renderer_styleElementAttributes !== void 0 ? _renderer_styleElementAttributes : {}\n    });\n    if (process.env.NODE_ENV !== 'production') {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        React.useEffect(()=>{\n            if (mergedTheme === undefined) {\n                // eslint-disable-next-line no-console\n                console.warn([\n                    '@fluentui/react-provider: FluentProvider does not have your \"theme\" defined.',\n                    \"Make sure that your top-level FluentProvider has set a `theme` prop or you're setting the theme in your child FluentProvider.\"\n                ].join(' '));\n            }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        }, []);\n    }\n    return {\n        applyStylesToPortals,\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        customStyleHooks_unstable: mergedCustomStyleHooks,\n        dir,\n        targetDocument,\n        theme: mergedTheme,\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        overrides_unstable: mergedOverrides,\n        themeClassName: styleTagId,\n        components: {\n            root: 'div'\n        },\n        root: slot.always(getIntrinsicElementProps('div', {\n            ...props,\n            dir,\n            // FIXME:\n            // `ref` is wrongly assigned to be `HTMLElement` instead of `HTMLDivElement`\n            // but since it would be a breaking change to fix it, we are casting ref to it's proper type\n            ref: useMergedRefs(ref, useFocusVisible({\n                targetDocument\n            }))\n        }), {\n            elementType: 'div'\n        }),\n        serverStyleProps: {\n            cssRule: rule,\n            attributes: {\n                ...renderer.styleElementAttributes,\n                id: styleTagId\n            }\n        }\n    };\n};\nfunction shallowMerge(a, b) {\n    // Merge impacts perf: we should like to avoid it if it's possible\n    if (a && b) {\n        return {\n            ...a,\n            ...b\n        };\n    }\n    if (a) {\n        return a;\n    }\n    return b;\n}\nfunction useTheme() {\n    return React.useContext(ThemeContext);\n}\n"],"names":["useFluentProvider_unstable","EMPTY_OBJECT","props","ref","parentContext","useFluent","parentTheme","useTheme","parentOverrides","useOverrides","parentCustomStyleHooks","React","useContext","CustomStyleHooksContext","applyStylesToPortals","customStyleHooks_unstable","dir","targetDocument","theme","overrides_unstable","overrides","mergedTheme","shallowMerge","mergedOverrides","mergedCustomStyleHooks","renderer","useRenderer_unstable","_renderer_styleElementAttributes","styleTagId","rule","useFluentProviderThemeStyleTag","rendererAttributes","styleElementAttributes","process","env","NODE_ENV","useEffect","undefined","console","warn","join","themeClassName","components","root","slot","always","getIntrinsicElementProps","useMergedRefs","useFocusVisible","elementType","serverStyleProps","cssRule","attributes","id","a","b","ThemeContext"],"mappings":";;;;+BAgBiBA;;;eAAAA;;;;uBAhBoB;8BACL;qCAC2J;gCAC7H;kEACvC;gDACwB;AAC/C,wFAAwF;AACxF,MAAMC,eAAe,CAAC;AASX,MAAMD,6BAA6B,CAACE,OAAOC;IAClD,MAAMC,gBAAgBC,IAAAA,uCAAS;IAC/B,MAAMC,cAAcC;IACpB,MAAMC,kBAAkBC,IAAAA,0CAAY;IACpC,MAAMC,yBAAyBC,QAAMC,UAAU,CAACC,qDAAuB,KAAKZ;IAC5E;;;;GAID,GAAG,MAAM,EAAEa,uBAAuB,IAAI,EACrCC,yBAAyB,EAAEC,MAAMZ,cAAcY,GAAG,EAAEC,iBAAiBb,cAAca,cAAc,EAAEC,KAAK,EAAEC,oBAAoBC,YAAY,CAAC,CAAC,EAAE,GAAGlB;IACjJ,MAAMmB,cAAcC,aAAahB,aAAaY;IAC9C,MAAMK,kBAAkBD,aAAad,iBAAiBY;IACtD,MAAMI,yBAAyBF,aAAaZ,wBAAwBK;IACpE,MAAMU,WAAWC,IAAAA,2BAAoB;IACrC,IAAIC;IACJ,MAAM,EAAEC,UAAU,EAAEC,IAAI,EAAE,GAAGC,IAAAA,8DAA8B,EAAC;QACxDZ,OAAOG;QACPJ;QACAc,oBAAoB,AAACJ,CAAAA,mCAAmCF,SAASO,sBAAsB,AAAD,MAAO,QAAQL,qCAAqC,KAAK,IAAIA,mCAAmC,CAAC;IAC3L;IACA,IAAIM,QAAQC,GAAG,CAACC,QAAQ,KAAK,cAAc;QACvC,sDAAsD;QACtDxB,QAAMyB,SAAS,CAAC;YACZ,IAAIf,gBAAgBgB,WAAW;gBAC3B,sCAAsC;gBACtCC,QAAQC,IAAI,CAAC;oBACT;oBACA;iBACH,CAACC,IAAI,CAAC;YACX;QACJ,uDAAuD;QACvD,GAAG,EAAE;IACT;IACA,OAAO;QACH1B;QACA,gEAAgE;QAChEC,2BAA2BS;QAC3BR;QACAC;QACAC,OAAOG;QACP,gEAAgE;QAChEF,oBAAoBI;QACpBkB,gBAAgBb;QAChBc,YAAY;YACRC,MAAM;QACV;QACAA,MAAMC,oBAAI,CAACC,MAAM,CAACC,IAAAA,wCAAwB,EAAC,OAAO;YAC9C,GAAG5C,KAAK;YACRc;YACA,SAAS;YACT,4EAA4E;YAC5E,4FAA4F;YAC5Fb,KAAK4C,IAAAA,6BAAa,EAAC5C,KAAK6C,IAAAA,6BAAe,EAAC;gBACpC/B;YACJ;QACJ,IAAI;YACAgC,aAAa;QACjB;QACAC,kBAAkB;YACdC,SAAStB;YACTuB,YAAY;gBACR,GAAG3B,SAASO,sBAAsB;gBAClCqB,IAAIzB;YACR;QACJ;IACJ;AACJ;AACA,SAASN,aAAagC,CAAC,EAAEC,CAAC;IACtB,kEAAkE;IAClE,IAAID,KAAKC,GAAG;QACR,OAAO;YACH,GAAGD,CAAC;YACJ,GAAGC,CAAC;QACR;IACJ;IACA,IAAID,GAAG;QACH,OAAOA;IACX;IACA,OAAOC;AACX;AACA,SAAShD;IACL,OAAOI,QAAMC,UAAU,CAAC4C,0CAAY;AACxC"}