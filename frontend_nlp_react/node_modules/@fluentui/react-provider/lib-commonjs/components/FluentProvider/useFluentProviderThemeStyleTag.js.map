{"version":3,"sources":["useFluentProviderThemeStyleTag.js"],"sourcesContent":["import { useId, useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { createCSSRuleFromTheme } from './createCSSRuleFromTheme';\nimport { fluentProviderClassNames } from './useFluentProviderStyles.styles';\n// String concatenation is used to prevent bundlers to complain with older versions of React\nconst useInsertionEffect = React['useInsertion' + 'Effect'] ? React['useInsertion' + 'Effect'] : useIsomorphicLayoutEffect;\nconst createStyleTag = (target, elementAttributes)=>{\n    if (!target) {\n        return undefined;\n    }\n    const tag = target.createElement('style');\n    Object.keys(elementAttributes).forEach((attrName)=>{\n        tag.setAttribute(attrName, elementAttributes[attrName]);\n    });\n    target.head.appendChild(tag);\n    return tag;\n};\nconst insertSheet = (tag, rule)=>{\n    const sheet = tag.sheet;\n    if (sheet) {\n        if (sheet.cssRules.length > 0) {\n            sheet.deleteRule(0);\n        }\n        sheet.insertRule(rule, 0);\n    } else if (process.env.NODE_ENV !== 'production') {\n        // eslint-disable-next-line no-console\n        console.error('FluentProvider: No sheet available on styleTag, styles will not be inserted into DOM.');\n    }\n};\n/**\n * Writes a theme as css variables in a style tag on the provided targetDocument as a rule applied to a CSS class\n * @internal\n * @returns CSS class to apply the rule\n */ export const useFluentProviderThemeStyleTag = (options)=>{\n    const { targetDocument, theme, rendererAttributes } = options;\n    const styleTag = React.useRef();\n    const styleTagId = useId(fluentProviderClassNames.root);\n    const styleElementAttributes = rendererAttributes;\n    const rule = React.useMemo(()=>createCSSRuleFromTheme(`.${styleTagId}`, theme), [\n        theme,\n        styleTagId\n    ]);\n    if (process.env.NODE_ENV !== 'production') {\n        // eslint-disable-next-line react-hooks/rules-of-hooks\n        React.useMemo(()=>{\n            // Heads up!\n            // .useMemo() is used because it is called during render and DOM for _current_ component is not mounted yet. Also,\n            // this allows to do checks with strict mode enabled as .useEffect() will be called with incremented IDs because\n            // of double render.\n            if (targetDocument) {\n                const providerSelector = `.${fluentProviderClassNames.root}.${styleTagId}`;\n                const providerElements = targetDocument.querySelectorAll(providerSelector);\n                // In SSR, we will have DOM upfront. To avoid false positives the check on nested style tag is performed\n                const isSSR = targetDocument.querySelector(`${providerSelector} > style[id=\"${styleTagId}\"]`) !== null;\n                const elementsCount = isSSR ? 1 : 0;\n                if (providerElements.length > elementsCount) {\n                    // eslint-disable-next-line no-console\n                    console.error([\n                        '@fluentui/react-provider: There are conflicting ids in your DOM.',\n                        'Please make sure that you configured your application properly.',\n                        '\\n',\n                        '\\n',\n                        'Configuration guide: https://aka.ms/fluentui-conflicting-ids'\n                    ].join(' '));\n                }\n            }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        }, []);\n    }\n    useHandleSSRStyleElements(targetDocument, styleTagId);\n    useInsertionEffect(()=>{\n        // The style element could already have been created during SSR - no need to recreate it\n        const ssrStyleElement = targetDocument === null || targetDocument === void 0 ? void 0 : targetDocument.getElementById(styleTagId);\n        if (ssrStyleElement) {\n            styleTag.current = ssrStyleElement;\n        } else {\n            styleTag.current = createStyleTag(targetDocument, {\n                ...styleElementAttributes,\n                id: styleTagId\n            });\n            if (styleTag.current) {\n                insertSheet(styleTag.current, rule);\n            }\n        }\n        return ()=>{\n            var _styleTag_current;\n            (_styleTag_current = styleTag.current) === null || _styleTag_current === void 0 ? void 0 : _styleTag_current.remove();\n        };\n    }, [\n        styleTagId,\n        targetDocument,\n        rule,\n        styleElementAttributes\n    ]);\n    return {\n        styleTagId,\n        rule\n    };\n};\nfunction useHandleSSRStyleElements(targetDocument, styleTagId) {\n    // Using a state factory so that this logic only runs once per render\n    // Each FluentProvider can create its own style element during SSR as a slot\n    // Moves all theme style elements to document head during render to avoid hydration errors.\n    // Should be strict mode safe since the logic is idempotent.\n    React.useState(()=>{\n        if (!targetDocument) {\n            return;\n        }\n        const themeStyleElement = targetDocument.getElementById(styleTagId);\n        if (themeStyleElement) {\n            targetDocument.head.append(themeStyleElement);\n        }\n    });\n}\n"],"names":["useFluentProviderThemeStyleTag","useInsertionEffect","React","useIsomorphicLayoutEffect","createStyleTag","target","elementAttributes","undefined","tag","createElement","Object","keys","forEach","attrName","setAttribute","head","appendChild","insertSheet","rule","sheet","cssRules","length","deleteRule","insertRule","process","env","NODE_ENV","console","error","options","targetDocument","theme","rendererAttributes","styleTag","useRef","styleTagId","useId","fluentProviderClassNames","root","styleElementAttributes","useMemo","createCSSRuleFromTheme","providerSelector","providerElements","querySelectorAll","isSSR","querySelector","elementsCount","join","useHandleSSRStyleElements","ssrStyleElement","getElementById","current","id","_styleTag_current","remove","useState","themeStyleElement","append"],"mappings":"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"}