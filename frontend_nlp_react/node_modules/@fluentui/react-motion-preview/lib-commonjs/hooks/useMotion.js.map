{"version":3,"sources":["useMotion.js"],"sourcesContent":["import * as React from 'react';\nimport { useAnimationFrame, useTimeout, useFirstMount } from '@fluentui/react-utilities';\nimport { useReducedMotion } from './useReducedMotion';\nimport { getMotionDuration } from '../utils/dom-style';\n/**\n * @internal\n *\n * Checks if components was mounted after first render and a certain condition is met.\n *\n * @param condition - Condition to check\n */ const useFirstMountCondition = (condition)=>{\n    const isFirst = React.useRef(true);\n    if (isFirst.current && condition) {\n        isFirst.current = false;\n        return true;\n    }\n    return isFirst.current;\n};\n/**\n * @internal\n *\n * Hook to manage the presence of an element in the DOM based on its CSS transition/animation state.\n *\n * @param present - Whether the element should be present in the DOM\n * @param events - Callbacks for when the element enters or exits the DOM\n */ function useMotionPresence(presence, options = {}) {\n    const { animateOnFirstMount, duration } = {\n        animateOnFirstMount: false,\n        ...options\n    };\n    const [type, setType] = React.useState(presence && animateOnFirstMount ? 'entering' : presence ? 'idle' : 'unmounted');\n    const [active, setActive] = React.useState(!animateOnFirstMount && presence);\n    const [setAnimationTimeout, clearAnimationTimeout] = useTimeout();\n    const [setTickTimeout, clearTickTimeout] = useTimeout();\n    const [setAnimationFrame, cancelAnimationFrame] = useAnimationFrame();\n    const [currentElement, setCurrentElement] = React.useState(null);\n    const isReducedMotion = useReducedMotion();\n    const isFirstReactRender = useFirstMount();\n    const isFirstDOMRender = useFirstMountCondition(!!currentElement);\n    const isInitiallyPresent = React.useRef(presence).current;\n    const disableAnimation = isReducedMotion || isFirstDOMRender && isInitiallyPresent && !animateOnFirstMount;\n    const ref = React.useCallback((node)=>{\n        if (!node) {\n            return;\n        }\n        setCurrentElement(node);\n    }, []);\n    const nextTick = React.useCallback((cb)=>{\n        setTickTimeout(()=>setAnimationFrame(cb), 0);\n        return ()=>{\n            clearTickTimeout();\n            cancelAnimationFrame();\n        };\n    }, [\n        cancelAnimationFrame,\n        clearTickTimeout,\n        setAnimationFrame,\n        setTickTimeout\n    ]);\n    const onFinished = React.useCallback(()=>{\n        setType(presence ? 'entered' : 'exited');\n        nextTick(()=>setType(presence ? 'idle' : 'unmounted'));\n    }, [\n        nextTick,\n        presence\n    ]);\n    React.useEffect(()=>{\n        if (isFirstReactRender) {\n            return;\n        }\n        // In case animation is disabled, we can skip the animation and go straight to the idle state.\n        if (disableAnimation) {\n            setType(presence ? 'idle' : 'unmounted');\n            setActive(presence);\n            return;\n        }\n        setType(presence ? 'entering' : 'exiting');\n        // If the element is not rendered, nothing to do.\n        if (!currentElement) {\n            return;\n        }\n        // Wait for the next frame to ensure the element is rendered and the animation can start.\n        nextTick(()=>{\n            setActive(presence);\n            // Wait for the next frame to ensure the animation has started.\n            nextTick(()=>{\n                const finalDuration = duration || getMotionDuration(currentElement);\n                if (finalDuration === 0) {\n                    onFinished();\n                    return;\n                }\n                /**\n         * Wait for the animation to finish before updating the state.\n         * This is an alternative to using the `transitionend` event which can be unreliable as it fires multiple times\n         * if the transition has multiple properties.\n         */ setAnimationTimeout(()=>onFinished(), finalDuration);\n            });\n        });\n        return ()=>clearAnimationTimeout();\n    /*\n     * Only tracks dependencies that are either not stable or are used in the callbacks\n     * This is to avoid re-running the effect on every render, especially when the DOM element is not rendered\n     */ // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [\n        currentElement,\n        disableAnimation,\n        onFinished,\n        presence\n    ]);\n    return React.useMemo(()=>({\n            ref,\n            type,\n            active,\n            canRender: presence || type !== 'unmounted'\n        }), // No need to add ref to the deps array as it is stable\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n        active,\n        type,\n        presence\n    ]);\n}\n/**\n * Returns a default motion state.\n */ export function getDefaultMotionState() {\n    return {\n        ref: React.createRef(),\n        type: 'unmounted',\n        active: false,\n        canRender: false\n    };\n}\n/**\n * Hook to manage the presence of an element in the DOM based on its CSS transition/animation state.\n *\n * @param props - Motion props to manage the presence of an element in the DOM\n * @param options - Motion options to configure the hook\n */ export function useMotion(shorthand, options) {\n    const isShorthand = typeof shorthand === 'object';\n    const motion = useMotionPresence(isShorthand ? false : shorthand, options);\n    return isShorthand ? shorthand : motion;\n}\n"],"names":["getDefaultMotionState","useMotion","useFirstMountCondition","condition","isFirst","React","useRef","current","useMotionPresence","presence","options","animateOnFirstMount","duration","type","setType","useState","active","setActive","setAnimationTimeout","clearAnimationTimeout","useTimeout","setTickTimeout","clearTickTimeout","setAnimationFrame","cancelAnimationFrame","useAnimationFrame","currentElement","setCurrentElement","isReducedMotion","useReducedMotion","isFirstReactRender","useFirstMount","isFirstDOMRender","isInitiallyPresent","disableAnimation","ref","useCallback","node","nextTick","cb","onFinished","useEffect","finalDuration","getMotionDuration","useMemo","canRender","createRef","shorthand","isShorthand","motion"],"mappings":"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"}