{"version":3,"sources":["useToasterFocusManagement.ts"],"sourcesContent":["import { isHTMLElement } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { ArrowDown, ArrowUp } from '@fluentui/keyboard-keys';\nimport { toastContainerClassNames } from '../ToastContainer';\n\nconst noop = () => undefined;\n\n/**\n * @internal\n */\nexport function useToasterFocusManagement_unstable(pauseAllToasts: () => void, playAllToasts: () => void) {\n  const { targetDocument } = useFluent();\n  const cleanupListenersRef = React.useRef<() => void>(noop);\n\n  return React.useCallback(\n    (el: HTMLDivElement) => {\n      if (!el || !targetDocument) {\n        cleanupListenersRef.current();\n        cleanupListenersRef.current = noop;\n        return;\n      }\n\n      const toastContainerWalker = targetDocument.createTreeWalker(el, NodeFilter.SHOW_ELEMENT, {\n        acceptNode(node: Node) {\n          if (isHTMLElement(node) && node.classList.contains(toastContainerClassNames.root)) {\n            return NodeFilter.FILTER_ACCEPT;\n          }\n\n          return NodeFilter.FILTER_SKIP;\n        },\n      });\n\n      /**\n       * FIXME: https://github.com/microsoft/tabster/issues/299\n       * Toasts  should be arrow navigable and focus should be trapped in a stack of tasts\n       * This is a temporary measure, Tabster does not have an API yet to enable mover arrow keys from within grouppers\n       * Once tabster fully supports this use case, remove this hook\n       */\n      const keydownListener = (e: KeyboardEvent) => {\n        const { target, key } = e;\n        if (!isHTMLElement(target)) {\n          return;\n        }\n\n        if (key === ArrowDown) {\n          toastContainerWalker.currentNode = target;\n          let nextToastContainer = toastContainerWalker.nextNode();\n          if (!nextToastContainer) {\n            toastContainerWalker.currentNode = el;\n            nextToastContainer = toastContainerWalker.nextNode();\n          }\n\n          if (isHTMLElement(nextToastContainer)) {\n            nextToastContainer.focus();\n          }\n        }\n\n        if (key === ArrowUp) {\n          toastContainerWalker.currentNode = target;\n          let prevToastContainer = toastContainerWalker.previousNode();\n          if (prevToastContainer && prevToastContainer.contains(target)) {\n            prevToastContainer = toastContainerWalker.previousNode();\n          }\n\n          if (!prevToastContainer) {\n            toastContainerWalker.currentNode = el;\n            prevToastContainer = toastContainerWalker.lastChild();\n          }\n\n          if (isHTMLElement(prevToastContainer)) {\n            prevToastContainer.focus();\n          }\n        }\n      };\n\n      const focusInListener = (e: FocusEvent) => {\n        if (\n          isHTMLElement(e.currentTarget) &&\n          !e.currentTarget.contains(isHTMLElement(e.relatedTarget) ? e.relatedTarget : null)\n        ) {\n          pauseAllToasts();\n        }\n      };\n\n      const focusOutListener = (e: FocusEvent) => {\n        if (\n          isHTMLElement(e.currentTarget) &&\n          !e.currentTarget.contains(isHTMLElement(e.relatedTarget) ? e.relatedTarget : null)\n        ) {\n          playAllToasts();\n        }\n      };\n\n      el.addEventListener('keydown', keydownListener);\n      el.addEventListener('focusin', focusInListener);\n      el.addEventListener('focusout', focusOutListener);\n\n      cleanupListenersRef.current = () => {\n        el.removeEventListener('keydown', keydownListener);\n        el.removeEventListener('focusin', focusInListener);\n        el.removeEventListener('focusout', focusOutListener);\n      };\n    },\n    [targetDocument, pauseAllToasts, playAllToasts],\n  );\n}\n"],"names":["isHTMLElement","React","useFluent_unstable","useFluent","ArrowDown","ArrowUp","toastContainerClassNames","noop","undefined","useToasterFocusManagement_unstable","pauseAllToasts","playAllToasts","targetDocument","cleanupListenersRef","useRef","useCallback","el","current","toastContainerWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","acceptNode","node","classList","contains","root","FILTER_ACCEPT","FILTER_SKIP","keydownListener","e","target","key","currentNode","nextToastContainer","nextNode","focus","prevToastContainer","previousNode","lastChild","focusInListener","currentTarget","relatedTarget","focusOutListener","addEventListener","removeEventListener"],"mappings":"AAAA,SAASA,aAAa,QAAQ,4BAA4B;AAC1D,YAAYC,WAAW,QAAQ;AAC/B,SAASC,sBAAsBC,SAAS,QAAQ,kCAAkC;AAClF,SAASC,SAAS,EAAEC,OAAO,QAAQ,0BAA0B;AAC7D,SAASC,wBAAwB,QAAQ,oBAAoB;AAE7D,MAAMC,OAAO,IAAMC;AAEnB;;CAEC,GACD,OAAO,SAASC,mCAAmCC,cAA0B,EAAEC,aAAyB;IACtG,MAAM,EAAEC,cAAc,EAAE,GAAGT;IAC3B,MAAMU,sBAAsBZ,MAAMa,MAAM,CAAaP;IAErD,OAAON,MAAMc,WAAW,CACtB,CAACC;QACC,IAAI,CAACA,MAAM,CAACJ,gBAAgB;YAC1BC,oBAAoBI,OAAO;YAC3BJ,oBAAoBI,OAAO,GAAGV;YAC9B;QACF;QAEA,MAAMW,uBAAuBN,eAAeO,gBAAgB,CAACH,IAAII,WAAWC,YAAY,EAAE;YACxFC,YAAWC,IAAU;gBACnB,IAAIvB,cAAcuB,SAASA,KAAKC,SAAS,CAACC,QAAQ,CAACnB,yBAAyBoB,IAAI,GAAG;oBACjF,OAAON,WAAWO,aAAa;gBACjC;gBAEA,OAAOP,WAAWQ,WAAW;YAC/B;QACF;QAEA;;;;;OAKC,GACD,MAAMC,kBAAkB,CAACC;YACvB,MAAM,EAAEC,MAAM,EAAEC,GAAG,EAAE,GAAGF;YACxB,IAAI,CAAC9B,cAAc+B,SAAS;gBAC1B;YACF;YAEA,IAAIC,QAAQ5B,WAAW;gBACrBc,qBAAqBe,WAAW,GAAGF;gBACnC,IAAIG,qBAAqBhB,qBAAqBiB,QAAQ;gBACtD,IAAI,CAACD,oBAAoB;oBACvBhB,qBAAqBe,WAAW,GAAGjB;oBACnCkB,qBAAqBhB,qBAAqBiB,QAAQ;gBACpD;gBAEA,IAAInC,cAAckC,qBAAqB;oBACrCA,mBAAmBE,KAAK;gBAC1B;YACF;YAEA,IAAIJ,QAAQ3B,SAAS;gBACnBa,qBAAqBe,WAAW,GAAGF;gBACnC,IAAIM,qBAAqBnB,qBAAqBoB,YAAY;gBAC1D,IAAID,sBAAsBA,mBAAmBZ,QAAQ,CAACM,SAAS;oBAC7DM,qBAAqBnB,qBAAqBoB,YAAY;gBACxD;gBAEA,IAAI,CAACD,oBAAoB;oBACvBnB,qBAAqBe,WAAW,GAAGjB;oBACnCqB,qBAAqBnB,qBAAqBqB,SAAS;gBACrD;gBAEA,IAAIvC,cAAcqC,qBAAqB;oBACrCA,mBAAmBD,KAAK;gBAC1B;YACF;QACF;QAEA,MAAMI,kBAAkB,CAACV;YACvB,IACE9B,cAAc8B,EAAEW,aAAa,KAC7B,CAACX,EAAEW,aAAa,CAAChB,QAAQ,CAACzB,cAAc8B,EAAEY,aAAa,IAAIZ,EAAEY,aAAa,GAAG,OAC7E;gBACAhC;YACF;QACF;QAEA,MAAMiC,mBAAmB,CAACb;YACxB,IACE9B,cAAc8B,EAAEW,aAAa,KAC7B,CAACX,EAAEW,aAAa,CAAChB,QAAQ,CAACzB,cAAc8B,EAAEY,aAAa,IAAIZ,EAAEY,aAAa,GAAG,OAC7E;gBACA/B;YACF;QACF;QAEAK,GAAG4B,gBAAgB,CAAC,WAAWf;QAC/Bb,GAAG4B,gBAAgB,CAAC,WAAWJ;QAC/BxB,GAAG4B,gBAAgB,CAAC,YAAYD;QAEhC9B,oBAAoBI,OAAO,GAAG;YAC5BD,GAAG6B,mBAAmB,CAAC,WAAWhB;YAClCb,GAAG6B,mBAAmB,CAAC,WAAWL;YAClCxB,GAAG6B,mBAAmB,CAAC,YAAYF;QACrC;IACF,GACA;QAAC/B;QAAgBF;QAAgBC;KAAc;AAEnD"}