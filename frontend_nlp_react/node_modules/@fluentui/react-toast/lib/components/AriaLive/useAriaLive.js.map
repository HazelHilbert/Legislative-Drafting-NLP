{"version":3,"sources":["useAriaLive.ts"],"sourcesContent":["import * as React from 'react';\nimport { createPriorityQueue, useEventCallback, slot } from '@fluentui/react-utilities';\nimport type { AnnounceOptions, AriaLiveProps, AriaLiveState, LiveMessage } from './AriaLive.types';\n\n/** The duration the message needs to be in present in DOM for screen readers to register a change and announce */\nconst MESSAGE_DURATION = 500;\n\n/**\n * Create the state required to render AriaLive.\n *\n * The returned state can be modified with hooks such as useAriaLiveStyles_unstable,\n * before being passed to renderAriaLive_unstable.\n *\n * @param props - props from this instance of AriaLive\n */\nexport const useAriaLive_unstable = (props: AriaLiveProps): AriaLiveState => {\n  const [currentMessage, setCurrentMessage] = React.useState<LiveMessage | undefined>(undefined);\n  // Can't rely on Date.now() if user invokes announce more than once in a code block\n  const order = React.useRef(0);\n  const [messageQueue] = React.useState(() =>\n    createPriorityQueue<LiveMessage>((a, b) => {\n      if (a.politeness === b.politeness) {\n        return a.createdAt - b.createdAt;\n      }\n\n      return a.politeness === 'assertive' ? -1 : 1;\n    }),\n  );\n\n  const announce = useEventCallback((message: string, options: AnnounceOptions) => {\n    const { politeness } = options;\n    if (message === currentMessage?.message) {\n      return;\n    }\n\n    const liveMessage: LiveMessage = {\n      message,\n      politeness,\n      createdAt: order.current++,\n    };\n\n    if (!currentMessage) {\n      setCurrentMessage(liveMessage);\n    } else {\n      messageQueue.enqueue(liveMessage);\n    }\n  });\n\n  React.useEffect(() => {\n    const timeout = setTimeout(() => {\n      if (messageQueue.peek()) {\n        setCurrentMessage(messageQueue.dequeue());\n      } else {\n        setCurrentMessage(undefined);\n      }\n    }, MESSAGE_DURATION);\n\n    return () => clearTimeout(timeout);\n  }, [currentMessage, messageQueue]);\n\n  React.useImperativeHandle(props.announceRef, () => announce);\n\n  const politeMessage = currentMessage?.politeness === 'polite' ? currentMessage.message : undefined;\n  const assertiveMessage = currentMessage?.politeness === 'assertive' ? currentMessage.message : undefined;\n\n  return {\n    components: {\n      assertive: 'div',\n      polite: 'div',\n    },\n\n    assertive: slot.always(props.assertive, {\n      defaultProps: { 'aria-live': 'assertive', children: assertiveMessage },\n      elementType: 'div',\n    }),\n    polite: slot.always(props.polite, {\n      defaultProps: { 'aria-live': 'polite', children: politeMessage },\n      elementType: 'div',\n    }),\n  };\n};\n"],"names":["React","createPriorityQueue","useEventCallback","slot","MESSAGE_DURATION","useAriaLive_unstable","props","currentMessage","setCurrentMessage","useState","undefined","order","useRef","messageQueue","a","b","politeness","createdAt","announce","message","options","liveMessage","current","enqueue","useEffect","timeout","setTimeout","peek","dequeue","clearTimeout","useImperativeHandle","announceRef","politeMessage","assertiveMessage","components","assertive","polite","always","defaultProps","children","elementType"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,mBAAmB,EAAEC,gBAAgB,EAAEC,IAAI,QAAQ,4BAA4B;AAGxF,gHAAgH,GAChH,MAAMC,mBAAmB;AAEzB;;;;;;;CAOC,GACD,OAAO,MAAMC,uBAAuB,CAACC;IACnC,MAAM,CAACC,gBAAgBC,kBAAkB,GAAGR,MAAMS,QAAQ,CAA0BC;IACpF,mFAAmF;IACnF,MAAMC,QAAQX,MAAMY,MAAM,CAAC;IAC3B,MAAM,CAACC,aAAa,GAAGb,MAAMS,QAAQ,CAAC,IACpCR,oBAAiC,CAACa,GAAGC;YACnC,IAAID,EAAEE,UAAU,KAAKD,EAAEC,UAAU,EAAE;gBACjC,OAAOF,EAAEG,SAAS,GAAGF,EAAEE,SAAS;YAClC;YAEA,OAAOH,EAAEE,UAAU,KAAK,cAAc,CAAC,IAAI;QAC7C;IAGF,MAAME,WAAWhB,iBAAiB,CAACiB,SAAiBC;QAClD,MAAM,EAAEJ,UAAU,EAAE,GAAGI;QACvB,IAAID,aAAYZ,2BAAAA,qCAAAA,eAAgBY,OAAO,GAAE;YACvC;QACF;QAEA,MAAME,cAA2B;YAC/BF;YACAH;YACAC,WAAWN,MAAMW,OAAO;QAC1B;QAEA,IAAI,CAACf,gBAAgB;YACnBC,kBAAkBa;QACpB,OAAO;YACLR,aAAaU,OAAO,CAACF;QACvB;IACF;IAEArB,MAAMwB,SAAS,CAAC;QACd,MAAMC,UAAUC,WAAW;YACzB,IAAIb,aAAac,IAAI,IAAI;gBACvBnB,kBAAkBK,aAAae,OAAO;YACxC,OAAO;gBACLpB,kBAAkBE;YACpB;QACF,GAAGN;QAEH,OAAO,IAAMyB,aAAaJ;IAC5B,GAAG;QAAClB;QAAgBM;KAAa;IAEjCb,MAAM8B,mBAAmB,CAACxB,MAAMyB,WAAW,EAAE,IAAMb;IAEnD,MAAMc,gBAAgBzB,CAAAA,2BAAAA,qCAAAA,eAAgBS,UAAU,MAAK,WAAWT,eAAeY,OAAO,GAAGT;IACzF,MAAMuB,mBAAmB1B,CAAAA,2BAAAA,qCAAAA,eAAgBS,UAAU,MAAK,cAAcT,eAAeY,OAAO,GAAGT;IAE/F,OAAO;QACLwB,YAAY;YACVC,WAAW;YACXC,QAAQ;QACV;QAEAD,WAAWhC,KAAKkC,MAAM,CAAC/B,MAAM6B,SAAS,EAAE;YACtCG,cAAc;gBAAE,aAAa;gBAAaC,UAAUN;YAAiB;YACrEO,aAAa;QACf;QACAJ,QAAQjC,KAAKkC,MAAM,CAAC/B,MAAM8B,MAAM,EAAE;YAChCE,cAAc;gBAAE,aAAa;gBAAUC,UAAUP;YAAc;YAC/DQ,aAAa;QACf;IACF;AACF,EAAE"}